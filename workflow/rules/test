rule create_annotation_list:
    input:
        emapper_dirs        = expand(rules.emapper.output.output_dir, sample=SAMPLES),
        emapper_annotations = expand(rules.emapper.output.annotaions, sample=SAMPLES)
    output:
        annotation_list     = OUTPUT_DIR + "kegganog/annotation.txt"
    message:
        "Creating annotation list for KEGGaNOG multi mode"
    params:
        output_dir          = OUTPUT_DIR + "kegganog/"
    shell:
        "mkdir -p {params.output_dir}; "
        "find {input.emapper_dirs} -type f -name "*.emapper.annotations" | sort > {output.annotation_list}"



rule kegganog:
    input:
        annotation_list        = expand(rule.create_annotation_list.output.annotation_list, sample=SAMPLES)
    output:
        kegganog_dir           = OUTPUT_DIR + "kegganog/"
    conda:
        "kegganog_env"  
    message:
        "Running KEGGaNOG in multi mode on all annotation files"
    shell:
        "KEGGaNOG "
        "-M "
        "-dpi 600 "
        "-g "
        "-i {input.annotation_list} "
        "-o {output.kegganog_dir}"


